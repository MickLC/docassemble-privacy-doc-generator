---
# ===============================================
# JURISDICTION ENGINE
# Runs auto-detection then presents results
# for attorney review and manual override.
# ===============================================

# Step 1: Run the auto-detection Python function
code: |
  matters[i].auto_detected_jurisdictions = detect_applicable_jurisdictions(
    operating_regions=matters[i].footprint.operating_regions,
    consumer_regions=matters[i].footprint.consumer_regions,
    annual_revenue=matters[i].footprint.annual_revenue,
    consumer_volume=matters[i].footprint.consumer_volume,
    sells_data=matters[i].footprint.sells_data,
    is_sba_small_business=matters[i].footprint.is_sba_small_business
  )
sets: matters[i].auto_detected_jurisdictions
---
# Step 2: Present results and allow override
question: |
  Applicable Privacy Laws — ${ matters[i].org.name.text }
subquestion: |
  Based on the operational footprint you provided, the system has assessed
  applicability for each jurisdiction below. Review the reasons and adjust
  the selection to reflect your professional judgment.

  % for j in matters[i].auto_detected_jurisdictions:
  **${ j['name'] }** — ${ j['reason'] }

  % endfor
fields:
  - label: Confirmed applicable jurisdictions
    field: matters[i].confirmed_jurisdictions
    datatype: checkboxes
    choices:
      - GDPR
      - CCPA/CPRA
      - TDPSA
      - VCDPA
    default code: |
      [j['name'] for j in matters[i].auto_detected_jurisdictions if j['applies']]
